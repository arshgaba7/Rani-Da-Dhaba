{% extends "base.html" %}

{% block content %}

  <style>
    /* Layout for chef photo + order form side-by-side */
    .order-layout {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        align-items: flex-start;
    }
    .chef-card {
        flex: 0 0 260px;
        max-width: 260px;
    }
    .chef-photo {
        width: 100%;
        border-radius: 16px;
        object-fit: cover;
        box-shadow: 0 10px 20px rgba(0,0,0,0.25);
    }
    .chef-caption {
        font-size: 13px;
        text-align: center;
        margin-top: 6px;
        color: var(--muted);
    }
    .order-main {
        flex: 1;
        min-width: 260px;
    }
    @media (max-width: 768px) {
        .order-layout {
            flex-direction: column;
        }
        .chef-card {
            max-width: 100%;
        }
    }
  </style>

  <h1 class="page-title">Place Your Order</h1>
  <p class="page-subtitle">
      Tap <strong>Add</strong> beside items you want. If you tap by mistake, use <strong>Remove</strong>.
      When you submit, the order pops up instantly on the Kitchen screen.
  </p>

  <div class="order-layout">
      <!-- LEFT: Chef photo -->
      <div class="card chef-card">
          <img src="{{ url_for('static', filename='chef.jpg') }}" alt="Chef at Maharani Dhaba" class="chef-photo">
          <div class="chef-caption">
              Chef in charge of Maharani Dhaba ‚ù§Ô∏è
          </div>
      </div>

      <!-- RIGHT: Order form -->
      <div class="order-main">
          {% if success_order %}
            <div class="success-banner">
                <strong>Order #{{ success_order.id }}</strong> placed successfully
                {% if success_order.created_at %} at {{ success_order.created_at }}{% endif %}.
                It‚Äôs on its way to the kitchen!
            </div>
          {% endif %}

          <form method="POST" action="{{ url_for('submit_order') }}">
              <div class="card">
                  <div class="card-header">
                      <span>Customer details</span>
                      <span class="pill">Optional but helpful üôÇ</span>
                  </div>
                  <div class="form-row">
                      <div class="form-field">
                          <label for="customer_name">Name</label>
                          <input type="text" id="customer_name" name="customer_name" placeholder="Guest">
                      </div>
                      <div class="form-field">
                          <label for="table">Table / Room</label>
                          <input type="text" id="table" name="table" placeholder="e.g. Living Room, Table 3">
                      </div>
                  </div>
              </div>

              <div class="card">
                  <div class="card-header">
                      <span>Menu</span>
                      <span class="pill">Tap ‚ÄúAdd‚Äù to add items, ‚ÄúRemove‚Äù to undo</span>
                  </div>

                  <div class="category-grid">
                      {% for category in categories %}
                        <div class="category-card">
                            <div class="category-title">{{ category.name }}</div>
                            <div>
                                {# IMPORTANT: use ["items"] not .items #}
                                {% for item in category["items"] %}
                                  <div class="menu-item-row">
                                      <span class="menu-item-name">{{ item.name }}</span>
                                      <div class="menu-item-actions">
                                          <!-- hidden input for quantity -->
                                          <input type="hidden"
                                                 name="qty_{{ item.id }}"
                                                 id="qty_{{ item.id }}"
                                                 value="0">

                                          <span class="badge-count" id="display_qty_{{ item.id }}">0</span>

                                          <button type="button"
                                                  class="btn btn-secondary btn-small add-btn"
                                                  data-target="{{ item.id }}">
                                              + Add
                                          </button>

                                          <button type="button"
                                                  class="btn btn-secondary btn-small remove-btn"
                                                  id="remove_{{ item.id }}"
                                                  data-target="{{ item.id }}"
                                                  style="display: none;">
                                              ‚àí Remove
                                          </button>
                                      </div>
                                  </div>
                                {% endfor %}
                            </div>
                        </div>
                      {% endfor %}
                  </div>

                  <div style="margin-top: 18px; text-align: right;">
                      <button type="submit" class="btn btn-primary">
                          Submit Order
                      </button>
                  </div>
              </div>
          </form>
      </div>
  </div>

  <script>
    // Add / Remove quantity logic
    document.addEventListener("DOMContentLoaded", function () {
        const addButtons = document.querySelectorAll(".add-btn");
        const removeButtons = document.querySelectorAll(".remove-btn");

        addButtons.forEach(btn => {
            btn.addEventListener("click", () => {
                const id = btn.getAttribute("data-target");
                const input = document.getElementById("qty_" + id);
                const badge = document.getElementById("display_qty_" + id);
                const removeBtn = document.getElementById("remove_" + id);

                let current = parseInt(input.value || "0", 10);
                current += 1;
                input.value = current.toString();
                badge.textContent = current.toString();

                if (removeBtn) {
                    removeBtn.style.display = "inline-flex";
                }
            });
        });

        removeButtons.forEach(btn => {
            btn.addEventListener("click", () => {
                const id = btn.getAttribute("data-target");
                const input = document.getElementById("qty_" + id);
                const badge = document.getElementById("display_qty_" + id);
                const removeBtn = document.getElementById("remove_" + id);

                let current = parseInt(input.value || "0", 10);
                if (current > 0) {
                    current -= 1;
                }
                input.value = current.toString();
                badge.textContent = current.toString();

                if (current <= 0 && removeBtn) {
                    removeBtn.style.display = "none";
                }
            });
        });
    });
  </script>
{% endblock %}
