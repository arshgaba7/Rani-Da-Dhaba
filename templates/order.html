{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2 style="margin-top:0;">Place Your Order</h2>

    <!-- Chef image -->
    <img src="{{ url_for('static', filename='chef.jpg') }}"
         alt="Chef"
         style="width:100%; max-width:400px; border-radius:1rem; display:block; margin:0 auto 1.2rem auto;">

    {# Confirmation message after successful order #}
    {% if success_order %}
        <div style="background:#e8ffe8; border-left:5px solid #28a745; padding:12px; margin-bottom:1rem; border-radius:6px;">
            <h3 style="margin:0; color:#1e7e34;">
                ✅ Order Placed Successfully!
            </h3>
            <p style="margin:4px 0 0;">
                Your order number is <strong>#{{ success_order.id }}</strong>.
            </p>

            <details style="margin-top:8px;">
                <summary style="cursor:pointer; color:#007bff;">View items ordered</summary>
                <ul style="margin-top:6px;">
                    {# IMPORTANT: note ['items'] not .items #}
                    {% for item in success_order['items'] %}
                        <li>{{ item.qty }} × {{ item.name }} ({{ item.category_name }})</li>
                    {% endfor %}
                </ul>
            </details>
        </div>
    {% endif %}

    <form method="post">

        {% for category in categories %}
            <h3 style="margin-top:1.5rem; margin-bottom:0.4rem;">
                {{ category.name }}
            </h3>

            <table style="width:100%; border-collapse:collapse;">
                <thead>
                <tr>
                    <th style="text-align:left; padding:6px;">Item</th>
                    <th style="text-align:left; padding:6px;">Added</th>
                    <th style="text-align:left; padding:6px;"></th>
                </tr>
                </thead>
                <tbody>
                {% for item in category['items'] %}
                    <tr>
                        <td style="padding:6px;">{{ item.name }}</td>
                        <td style="padding:6px;">
                            <span id="qty_display_{{ item.id }}">0</span>
                        </td>
                        <td style="padding:6px;">
                            <button type="button"
                                    onclick="addItem({{ item.id }})"
                                    style="padding:4px 10px; border-radius:6px; border:none; background:#007bff; color:white; cursor:pointer;">
                                Add
                            </button>
                            <input type="hidden"
                                   name="qty_{{ item.id }}"
                                   id="qty_input_{{ item.id }}"
                                   value="0">
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

        {% endfor %}

        <button type="submit"
                style="margin-top:1.5rem; padding:10px 20px; font-size:1rem; border:none; background:#28a745; color:white; border-radius:8px;">
            Send to Kitchen
        </button>

    </form>
</div>

<script>
    function addItem(id) {
        const input = document.getElementById("qty_input_" + id);
        const display = document.getElementById("qty_display_" + id);

        if (!input || !display) return;

        let current = parseInt(input.value || "0", 10);
        if (isNaN(current)) current = 0;
        current += 1;

        input.value = String(current);
        display.textContent = current;
    }
</script>
{% endblock %}
