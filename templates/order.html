{% extends "base.html" %}

{% block content %}
  <h1 class="page-title">Place Your Order</h1>
  <p class="page-subtitle">
      Tap <strong>Add</strong> beside items you want. When you submit, the order pops up instantly on the Kitchen screen.
  </p>

  {% if success_order %}
    <div class="success-banner">
        <strong>Order #{{ success_order.id }}</strong> placed successfully
        {% if success_order.created_at %} at {{ success_order.created_at }}{% endif %}.
        It‚Äôs on its way to the kitchen!
    </div>
  {% endif %}

  <form method="POST" action="{{ url_for('submit_order') }}">
      <div class="card">
          <div class="card-header">
              <span>Customer details</span>
              <span class="pill">Optional but helpful üôÇ</span>
          </div>
          <div class="form-row">
              <div class="form-field">
                  <label for="customer_name">Name</label>
                  <input type="text" id="customer_name" name="customer_name" placeholder="Guest">
              </div>
              <div class="form-field">
                  <label for="table">Table / Room</label>
                  <input type="text" id="table" name="table" placeholder="e.g. Living Room, Table 3">
              </div>
          </div>
      </div>

      <div class="card">
          <div class="card-header">
              <span>Menu</span>
              <span class="pill">Tap ‚ÄúAdd‚Äù to add items</span>
          </div>

          <div class="category-grid">
              {% for category in categories %}
                <div class="category-card">
                    <div class="category-title">{{ category.name }}</div>
                    <div>
                        {# NOTE: use ["items"] instead of .items to avoid conflict with dict.items() #}
                        {% for item in category["items"] %}
                          <div class="menu-item-row">
                              <span class="menu-item-name">{{ item.name }}</span>
                              <div class="menu-item-actions">
                                  <!-- hidden input for quantity -->
                                  <input type="hidden" name="qty_{{ item.id }}" id="qty_{{ item.id }}" value="0">
                                  <span class="badge-count" id="display_qty_{{ item.id }}">0</span>
                                  <button type="button"
                                          class="btn btn-secondary btn-small add-btn"
                                          data-target="{{ item.id }}">
                                      + Add
                                  </button>
                              </div>
                          </div>
                        {% endfor %}
                    </div>
                </div>
              {% endfor %}
          </div>

          <div style="margin-top: 18px; text-align: right;">
              <button type="submit" class="btn btn-primary">
                  Submit Order
              </button>
          </div>
      </div>
  </form>

  <script>
    // Simple JS to increment quantities when "Add" is clicked
    document.addEventListener("DOMContentLoaded", function () {
        const buttons = document.querySelectorAll(".add-btn");
        buttons.forEach(btn => {
            btn.addEventListener("click", () => {
                const id = btn.getAttribute("data-target");
                const input = document.getElementById("qty_" + id);
                const badge = document.getElementById("display_qty_" + id);

                let current = parseInt(input.value || "0", 10);
                current += 1;
                input.value = current.toString();
                badge.textContent = current.toString();
            });
        });
    });
  </script>
{% endblock %}
